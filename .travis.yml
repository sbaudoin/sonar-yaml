language: java
jdk:
  - openjdk11
git:
  depth: false
addons:
  sonarcloud:
    organization: "sbaudoin-github"
    token:
      secure: "iyDH2uGEKU53Bma09YYljBBYjGhqxWbLXbkiADMA8nBc73754bO/9uQLq1NGhVWi3stFGfxQ2LKBoCL1lqmLU54zN11WMZBW43ychiQsMx9M4XUSHyuEM9JPpseaL56kl99Vg8bJgvmsM/X/jo6GYWR72PhPnhOR70i5JZAv+2av9F7ST43m8MB2n6g0ToE5hjk/2KUpLgHKvdu94Oanvd5LcpIklPlMbJLCNUx4PrAyBuHxubXX0/IsIuRmEPdUPkZbeSuBxAEcxHBBj8mawIdDE1e70fWASb0xHsbnMe0ChcpUZrAE9qIchZQN5OtfTg3z73pxjvuLvTrpWX6f30pIAXgteDk1lQBksKlk0DHxE1/4m/vobZL+DjvGJjGrwV1iD2FiO3iBxO+DTaSHGqHbTdczf/BslqtdI5R+Hd3kuSk0g2swsVs9IhBtJo22BnY5CPub59nhHNrfEmEfMOo7TTf81GJPXyEtUazcz4PRqIHyn8U5WXq4+oPs0Cv5vimIaorK1BFVzfwDqa4n1CXF3bpnqntcpX5R79kDOqwTJevoiBc6EO65iPeLaTZltfvVch+sohthdTSW2tYM91lNxICWInWh5jrYho7eWEyL8b+MIGIIBchSVa/AqNW/QdHIOBc8SCrdMWLhDTbmkYvEtcoSXQb4is87pByQi44="
sudo: required
services:
  - docker
cache:
  directories:
    - '$HOME/.m2/repository'
    - '$HOME/.sonar/cache'
before_install:
  - if [ ! -z "$GPG_SECRET_KEYS" ]; then echo $GPG_SECRET_KEYS | base64 --decode | $GPG_EXECUTABLE --import; fi
  - if [ ! -z "$GPG_OWNERTRUST" ]; then echo $GPG_OWNERTRUST | base64 --decode | $GPG_EXECUTABLE --import-ownertrust; fi
install:
  - mvn --settings .travis/settings.xml install -DskipTests=true -Dgpg.skip -Dmaven.javadoc.skip=true -B -V
script:
  - 'if [ -z "$SONAR_TOKEN" ]; then mvn clean package -P audit; else mvn clean package sonar:sonar -Dsonar.projectKey=sbaudoin_sonar-yaml -P audit; fi'
  - bash it/it.sh 6.7-community 3.4.0.1729 || travis_terminate 1
  - bash it/it.sh 7.9-community 3.4.0.1729 11 || travis_terminate 1
  - bash it/it.sh 8.9-community 4.5.0.2216 11 || travis_terminate 1
  - bash it/it.sh 9.1-community 4.6.2.2472 11 || travis_terminate 1
  - bash it/it.sh 9.2-community 4.6.2.2472 11
deploy:
  - provider: script
    script: bash .travis/deploy.sh
    skip_cleanup: true
    on:
      repo: sbaudoin/sonar-yaml
      all_branches: true
  - provider: releases
    api_key:
      secure: "2Hk9vXRJ460B/CDbengjbfgxoZIPvroyCF2LoePJd4YV5OrVlJQyFvqe8Q7vpQCifDaKFBUufEZEPEpuYw32dE647FDaADNJPnDENPa2RnLX9pq1EtjadhvLLBQ7hrGoo7JhFhVsSkrQzolRGxa2phh4Sd8WvLFVLYokEcY1xU/IWLrP1iaoH4tL2X7tmHnFxmjzLwwf19cdYlpdrqrsRFJMxXWOJR80H4nf8laEzDeVrIB6GEt/vysNTiQArnjS+ld9LryLfIE+RxWUvnnIHsYR+fc7n2FArW279BsdLV0yI4aTLt/2+mIriMKw1zjCmczXWKDBQzlNbhRHi4/pdLNvX9ixZjvcg0jNGqHazDe/k5fpDR/qbf8hOZ/S6sRkt800OpRHYClVUe5NPf0pXy8pdipoLonuYX5qBO63m0A9L9KqlZSy+X1TgE6zMhEjbrIVXDHJoiAwWIQuLDk8ljaHGjPgUNtwjCQggvj1TP7TLYZdYHHYui63VZRYMJ0wihTwR3MZ8bor+e9GOu/M/aPDtHAWKmfjw8wu4B/N6eKbXt8VDTqwaSOvhXBoPN8f+EGecPEkqbw/MQn2Iq/PCnkrj3U+HNS45aHVijP+BBPra2+T6L4JYEw2/+RBZpHvayrcuhoVAMB37iW/3KhIszqs1bfhd/8eEKjsJeQw6qo="
    file_glob: true
    file:
      - target/sonar-yaml-plugin-*.jar
    skip_cleanup: true
    on:
      repo: sbaudoin/sonar-yaml
      tags: true
